<!DOCTYPE html>
<html>
  <head>
    <title>Go Play! </title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- Firebase Reference -->
    <script src="https://www.gstatic.com/firebasejs/4.9.0/firebase.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

    <link href='assets/css/style.css' rel='stylesheet' type='text/css'>
    <link href='assets/css/final.css' rel='stylesheet' type='text/css'>

    <style>

    </style>


  </head>
      <body >
            <div class="container">

                <div class="row">

                    <div class="col-md-4">

                        <h1>Welcom to GoPlay Powered by Google Maps API <a href="">GoPlay.com</a></h1>
                       <div id="info"></div>
                       <form method="post" name="contactForm">
                       <div class="form-group">
                         <label for="name">Name</label>
                         <input type="text" class="form-control" id="name" required placeholder="Enter name">
                       </div>
                       <div class="form-group">
                         <label for="email">Email</label>
                         <input type="email" class="form-control" id="email" required placeholder="Enter Email">
                       </div>
                       <h3>Location</h3>
                       <div class="form-group">
                         <label for="city">City</label>
                         <input type="text" class="form-control" id="city" placeholder="Enter City">
                       </div>
                       <div class="form-group">
                         <label for="email">State</label>
                         <input type="text" class="form-control" id="state" placeholder="Enter State">
                       </div>
                       <div class="form-group">
                         <label for="zip">Zip</label>
                         <input type="text" class="form-control" id="zip" placeholder="Enter Zip Code">
                       </div>
                       <button type="submit" class="btn btn-primary addValue">Submit</button>
                     </form>
                    </div>

                    <div id="map" style="width:auto; height:595px; margin:10 5 10 5; padding: 15px; border: 10px solid #000;"></div> <!---->

                </div>

            </div>


    </body>

    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyAliuFROXxq9K-tkBr7WDMwsJBEPrAMqxY",
        authDomain: "goplay-f0808.firebaseapp.com",
        databaseURL: "https://goplay-f0808.firebaseio.com",
        projectId: "goplay-f0808",
        storageBucket: "",
        messagingSenderId: "554942210651"
      };

      firebase.initializeApp(config);


      var map;
      var userPolygon;
      var polygonArray = [];
      var marker = [];
      var database = firebase.database();
      var dbRef = firebase.database();
      var contactsRef = dbRef.ref('contacts');

      //load older conatcts as well as any newly added one...
      contactsRef.on("child_added", function(snap) {
        //console.log("added", snap.key(), snap.val());
        document.querySelector('#contacts')
          //.innerHTML += contactHtmlFromObject(snap.val());
      });

      //save contact
      document.querySelector('.addValue')
        .addEventListener("click", function( event ) {
          event.preventDefault();
          if( document.querySelector('#name').value != ''
                || document.querySelector('#email').value != '' ){
            contactsRef.push({
              name: document.querySelector('#name').value,
              email: document.querySelector('#email').value,
              location: {
                city: document.querySelector('#city').value,
                state: document.querySelector('#state').value,
                zip: document.querySelector('#zip').value

              }
              //polygonLocation: document.querySelector('#map').value
            });
            contactForm.reset();
          } else {
            alert('Please fill at lease name or email!');
          }
        },
            false);


      function initMap() {
        var myLatlng = new google.maps.LatLng (38.81707399543383, -77.04867482185364);

        var myOptions = {
         zoom: 14,
         center: myLatlng,
         mapTypeId: google.maps.MapTypeId.ROADMAP
        }

        map = new google.maps.Map(document.getElementById('map'), myOptions);
        //http://jsfiddle.net/geocodezip/qe68usv3/1/
        var drawingManager = new google.maps.drawing.DrawingManager({
        drawingMode: google.maps.drawing.OverlayType.POLYGON,
        drawingControl: true,
        drawingControlOptions: {
          position: google.maps.ControlPosition.TOP_CENTER,
          drawingModes: ['circle', 'polygon']
        },
            markerOptions: {icon: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png'},
            circleOptions: {
              fillColor: '#ffff00',
              fillOpacity: 1,
              strokeWeight: 5,
              clickable: false,
              editable: true,
              zIndex: 1
            }
          });


        drawingManager.setMap(map);

        google.maps.event.addListener(map, 'dblclick', function(event) {
          var latitude = event.latLng.lat();
          var longitude = event.latLng.lng();
          console.log( latitude + ', ' + longitude );
            //alert(event.latLng);
        });

        google.maps.event.addListener(drawingManager, 'circlecomplete', function(circle) {
          var radius = circle.getRadius();
          console.log(circle);
        });

        google.maps.event.addListener(drawingManager, 'polygoncomplete', function(polygon) {
              var polyLength = polygon.getPath().getLength();
              for (var i = 0; i < polyLength; i++) {
                  var poly = polygon.getPath().getAt(i).toUrlValue(6);
                  polygonArray.push(poly);
                  //// Uploads employee data to the database
                  database.ref('contacts').push(polygonArray);
                  //// Uploads employee data to the database
                  //database.ref().push(polygonArray);
              }
              console.log(polygonArray);
          });

        } // end inti fuction

      google.maps.event.addDomListener(window, 'load', initMap);


    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1SJ3HV5ZGZkOfwO96Hku1mK2rl3sT_5I&libraries=geometry,drawing&callback=initMap"></script>

    <!-- Link Javascript File -->
     <script type="text/javascript" src="assets/javascript/app.js"></script>
     <script type="text/javascript" src="assets/javascript/clustermarkers.js"></script>

</html>
